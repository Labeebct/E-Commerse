<%- include('../components/head.ejs') %>

    <div class="wrapper checkout_wrapper">
        <%- include('../components/top_nav.ejs') %>
    <div class="content checkout_content">

            <div class="checkout_left">

                <!-- ----------------------------------- -->

                <div class="checkout_left_top">

                <% productArray.forEach((list)=>{ %>

                    <div class="product product<%= list._id %>" onclick="productOpen(event,'<%= list._id %>')">
                        <div class="image_sec"><img src="<%= list.productimg[0] %>" style="width: 8rem;" alt=""></div>
                        <div class="discription_sec">
                           <p class="product_name"><%= list.productname %></p>
                           <div style="display: flex; gap: 1rem; align-items: center;">
                              <select name="quantity" style="outline: none; padding: .3rem;" onclick="selectQuantity(event)" >
                                <option value="">Qty:<%= (() => {
                                    const productIdObjectId = new ObjectId(list._id )
                                    const productquantity = cartQuantity.find(product => product.productId.equals(productIdObjectId));
                                    return productquantity.quantity
                                    })() %>
                                </option>
                                 <option value="1">Qty:1</option>
                                 <option value="2">Qty:2</option>
                                 <option value="3">Qty:3</option>
                                 <option value="4">Qty:4</option>
                                 <option value="5">Qty:5</option>
                              </select>
                              <div class="stock_left"><%= list.stock %> Left</div>
                            </div>
                           <div style="display: flex; gap: .7rem; align-items: center;">
                            <p class="old_price"><i class="bi bi-currency-rupee"></i><%= list.oldprice.toLocaleString() %></p>
                            <p class="new_price"><i class="bi bi-currency-rupee"></i><%= list.newprice.toLocaleString() %></p>
                            <p class="discount"><%= Math.round(100 - (list.newprice / list.oldprice * 100)) %> %</p>
                           </div>

                        <div class="color_size">
                            <div class="size_li">
                                <p style="font-family: 'Poppins',sans-serif; font-weight: 500;font-size: .98rem; color: black;">SIZE :</p>

                                <% list.size.forEach((size) => { %>

                                    <span class="label_span"onclick="selectSize(event)">
                                    <input id="<%= size %>" value="<%= size %>" class="size" name="size" type="radio" >
                                    <label for="<%= size %>" ><%= size %></label>
                                    </span>
                                    
                                    <% }) %>
                                        
                            </div>

                            <!-- ------------------------------------- -->

                            
                     <div class="color_li">
                         <p style="font-family: 'Poppins',sans-serif;color: black;font-size: .93rem;">COLOR :</p>

                            <% list.color.forEach((color) => { %>

                           <span style="background-color:<%= color %>" class="label_span_color" onclick="selectColor(event)" >
                              <input  id="<%= color %>" name="color" value="<%= color %>" type="radio" >
                              <label for="<%= color %>" ></label>
                              </span>
                           
                           <% }) %>
                           
                     </div>

                           </div>

                           <li style="display: flex; gap: .7rem; align-items: center; height: 2rem;">
                            <div style="display: flex; align-items: center; font-family: 'sans-serif'; ">Return
                               <% if(list.returns) { %>
                                  <i class="bi bi-check"></i>
                                  <% } else{ %>
                                  <i class="bi bi-x"></i>
                                  <% } %>
                            </div>
                         </li>                     </div>
                        <div class="delete_section">
                           <div style="margin-bottom: 1rem;"><button onclick="deleteFromcheckout(event,'<%= list._id %>','<%= list.newprice %>')"><i class="bi bi-x-circle"></i></button></div>
                        </div>
                     </div>

                     <% }) %>


                </div>


              <!-- ----------------------------------- -->


                <div class="checkout_left_bottom">
                    <div class="checkouts_frame_bottom_frame checkouts_frame_bottom_payment">
                        <h3>PAYMENT METHODE</h3>
                        <div class="payment_divs"><div class="payment_icon"><img class="payment_logo_png" src="/images/upi.png" alt=""></div><label for="upi">UPI</label><input id="upi" name="payment" type="radio"></div>
                        <div class="payment_divs"><div class="payment_icon"><img class="payment_logo_png" src="/images/card.png" alt=""></div><label for="card">CARD</label><input id="card" name="payment" type="radio"></div>
                        <div class="payment_divs"><div class="payment_icon"><img class="payment_logo_png" src="/images/cashon delivery.png" alt=""></div><label for="cashondelivery">CASH ON DELIVERY</label><input id="cashondelivery" name="payment" type="radio"></div>
                    </div>


                    <div class="checkouts_frame_bottom_frame checkouts_frame_bottom_coupon">
                        <h3>COUPON</h3>
                        
                            <div class="coupon_input_frame">
                                <img src="/images/coupon.png" style="height: 3rem;" alt="">
                                <input type="text" placeholder="Apply Coupon">
                                <button class="coupon_check_btn">SELECT</button>
                            </div>

                        <ul class="coupon_ul">

                            <% coupons.forEach((coupon)=>{ %>

                            <li><%= coupon.couponnname %><p style="font-size: .7rem;">Amount<i class="bi bi-currency-rupee"></i><%= coupon.minamount %>-<i class="bi bi-currency-rupee"></i><%= coupon.maxamount %></p>
                                <span style="color: rgb(0, 152, 0); font-family: 'Poppins',sans-serif;"><%= coupon.discount %>%</span>
                                <span><button class="coupon_apply" onclick="selectCoupon('<%= coupon._id %>')">APPLY</button></span>
                            </li>

                            <% }) %>
                        </ul>
                    </div>

                    <div class="checkouts_frame_bottom_frame checkouts_frame_bottom_adress">
                        <h3>SELECT ADDRESS</h3>
                        <% userAddress.forEach((address,index)=>{ %>
                            <div class="payment_divs select_adress_div"><input id="add<%= index %>" name="payment" type="radio" onclick="selectAddress('<%- address._id %>')"><label for="add<%= index %>"><%= address.address %></label></div>
                        <% }) %>

                    </div>


                </div>
            </div>
            <div class="checkout_right">
                <div class="checkouts_frame checkout_adress_frame" style="pointer-events: none;">
                    <h3>ADDRESS</h3>
                    <div class="adress_frame">

                        <div style="display: flex;justify-content: space-between; width: 100%;">
                            <span style="display: flex; flex-direction: column;gap: .2rem; width: 50%;">
                                <label for="firstname" >First Name</label>
                                <input type="text"  value="<%= userAddress[0].firstname %>"  name="firstname" style="width: 100%;" >
                            </span>
                            <span style="display: flex; flex-direction: column;gap: .2rem;  width: 48%;">
                                <label for="lastname">Last Name</label>
                                <input  type="text" value="<%= userAddress[0].lastname %>" name="lastname" style="width: 100%; padding-left: 1rem" >
                            </span>
                        </div>

                        <span style="display: flex; flex-direction: column;gap: .2rem;  width: 100%;">
                           <label for="lastname">Mobile</label>  
                           <input  type="text" value="<%= userAddress[0].mobilenum %>" name="mobilenum" style="width: 100%; padding-left: 1rem" >
                       </span>

                       
                       <div style="display: flex;justify-content: space-between; width: 100%;">
                        <span style="display: flex; flex-direction: column;gap: .2rem; width: 50%;">
                            <label for="firstname" >Country</label>
                            <input type="text" value="<%= userAddress[0].country %>"  name="country" style="width: 100%;" >
                        </span>
                        <span style="display: flex; flex-direction: column;gap: .2rem;  width: 48%;">
                            <label for="lastname">State</label>
                            <input  type="text" value="<%= userAddress[0].state %>" name="state" style="width: 100%; padding-left: 1rem" >
                        </span>
                    </div>  
                    
                       <div style="display: flex;justify-content: space-between; width: 100%;">
                        <span style="display: flex; flex-direction: column;gap: .2rem; width: 78%;">
                            <label for="firstname" >District</label>
                            <input type="text" value="<%= userAddress[0].district %>"  name="district" style="width: 100%;" >
                        </span>
                        <span style="display: flex; flex-direction: column;gap: .2rem;  width: 20%;">
                            <label for="lastname">Zip</label>
                            <input  type="text" value="<%= userAddress[0].zip %>" name="zip" style="width: 100%; padding-left: 1rem" >
                        </span>
                    </div>  


                    <span style="display: flex; flex-direction: column;gap: .2rem;  width: 100%;">
                     <label for="lastname">Address</label>  
                     <textarea name="address" class="adress_text_area"><%= userAddress[0].address %></textarea>
                 </span>

                    </div>
                    
                </div>
                <div class="checkouts_frame checkouts_frame_add_new_address">
                    <div class="add_new_adress">ADD NEW ADDRESS<button class="droup_right_btn"><i class="bi plus_btn bi-plus"></i></button></div>
                    <form id="adrress_form" method="post">
                <div class="adress_frame adrees_add_drop">

                  <div style="display: flex;justify-content: space-between; width: 100%;">
                      <span style="display: flex; flex-direction: column;gap: .2rem; width: 50%;">
                          <label for="firstname" >First Name</label>
                          <input type="text"  name="firstname" style="width: 100%;" >
                      </span>
                      <span style="display: flex; flex-direction: column;gap: .2rem;  width: 48%;">
                          <label for="lastname">Last Name</label>
                          <input  type="text" name="lastname" style="width: 100%; padding-left: 1rem" >
                      </span>
                  </div>

                  <span style="display: flex; flex-direction: column;gap: .2rem;  width: 100%;">
                     <label for="lastname">Mobile</label>  
                     <input  type="number" name="mobilenum" style="width: 100%; padding-left: 1rem" >
                 </span>

                 
                 <div style="display: flex;justify-content: space-between; width: 100%;">
                  <span style="display: flex; flex-direction: column;gap: .2rem; width: 50%;">
                      <label for="firstname">Country</label>
                      <input type="text"  name="country" style="width: 100%;" >
                  </span>
                  <span style="display: flex; flex-direction: column;gap: .2rem;  width: 48%;">
                      <label for="lastname">State</label>
                      <input  type="text" name="state" style="width: 100%; padding-left: 1rem" >
                  </span>
              </div>  
              
                 <div style="display: flex;justify-content: space-between; width: 100%;">
                  <span style="display: flex; flex-direction: column;gap: .2rem; width: 78%;">
                      <label for="firstname" >District</label>
                      <input type="text"  name="district" style="width: 100%;" >
                  </span>
                  <span style="display: flex; flex-direction: column;gap: .2rem;  width: 20%;">
                      <label for="lastname">Zip</label>
                      <input  type="text" name="zip" style="width: 100%; padding-left: 1rem" >
                  </span>
              </div>  
              
              
              <span style="display: flex; flex-direction: column;gap: .2rem;  width: 100%;">
               <label for="lastname">Address</label>  
               <textarea name="address" class="adress_text_area"></textarea>
            </span>
            <p class="error_msg"></p>
            <input class="add_new_btn" onclick="addNewAddress()" type="button" value="ADD"> 
         </div>
        </form>
         
      </div>
      
      <div class="checkouts_frame checkout_total_price">
         <h3>SUMMARY</h3>
         <div class="summary_frame">
            <p>Subtotal <span><i class="bi bi-currency-rupee"></i><span class="sub_total"><%= cartTotal %></span></span></p>
                        <p>Shipping <span style="color: rgb(0, 160, 0);">FREE</span></p>
                        <p>Coupon <span class="coupon">Nill</span></p>
                        <p>Order Total <span><i class="bi bi-currency-rupee"></i><span class="order_total"><%= cartTotal %></span></span></p>
                        <button onclick="location.href='/order_summary' " class="proceed_btn">PROCEED</button>
                    </div>
                </div>
            </div>
          </div>

<%- include('../../common/footer.ejs') %>
    </div>
    
    <script src="/javascript/product-open.js"></script>
    <script src="/javascript/btnsearch.js"></script>
    <script src="/javascript/checkout.js"></script>

<%- include('../../common/end.ejs') %>
